
# 암호화 방식
## 1. 대칭키 암호화
* 동일한 키로 암호화, 복호화가 가능하다. 
* 동일한 키를 주고 받기 때문에 비대칭키(공개키)보다 빠르게 통신할 수 있다.

아래 예시는 "hello"라는 키워드를 대칭키를 사용하여 암호화/복호화하고 있다. 암호화하는 쪽이랑 복호화하는 쪽이랑 동일한 키를 사용한다. 

![](https://velog.velcdn.com/images/strangehoon/post/c9ff6691-8801-435a-a5f3-a380d76c1a60/image.png)


> **Plaintext + key = ciphertext** : hello + 2jd8932kd8 = X5xJCSycg14 </br>
**Ciphertext + key = plaintext** : X5xJCSycg14 + 2jd8932kd8 = hello

**그런데 문제는 어떻게 동일한 키를 애초에 양쪽이 공유하느냐이다.** 결국 한번은 한쪽에서 다른쪽으로 이 키를 전송해야 하는데 중간에 누군가가 탈취할 위험이 존재한다. 이러한 점이 대칭키의 한계이다. 이를 보완한것이 공개키(비대칭키) 암호화 방식이다. 

</br>




## 2. 공개키(비대칭키) 암호화
* 공개키 암호화는 비대칭키 암호화라고도 부른다.
* 암호화와 복호화에 사용하는 키를 분리한다.
  * A키로 암호화를 하면 B키로 복호화를 할 수 있다.
  * B키로 암호화를 하면 A키로 복호화를 할 수 있다.
* 자신이 가지고 있는 고유한 비밀키로만 복호화할 수 있는 공개키를 대중에 공개한다.

공개키 암호화 방식은 아래와 같다. 

1. A가 웹 상에 공개된 "네이버의 공개키"를 이용해 평문을 암호화하여 네이버에게 전송한다.
2. 네이버는 "자신의 비밀키"로 복호화한 평문을 확인, A의 공개키로 응답을 암호화하여 A에게 전송한다. 
3. A는 자신의 비밀키로 암호화된 응답문을 복호화한다. 
![](https://velog.velcdn.com/images/strangehoon/post/f8ec2b74-2361-48c7-82df-b17e2334c007/image.png)

만약 A가 네이버에게 전송하는 메시지가 해커에게 노출되면 어떻게 될까? 메시지는 네이버의 비밀키로만 복호화할 수 있기 때문에 안전하다. 여기서는 설명 편의상 공개키를 대중에게 공개한다고 했지만 사실은 CA와 인증서 관련하여 일부 과정이 생략되었다.(아래서 자세히 설명)
**하지만 공개키 방식은 암호화/복호화가 복잡하고 느리기 때문에 HTTPS 프로토콜인 TLS는 대칭키를 주고받을 때만 공개키 암호화 방식을 사용하고 이후에는 계속 대칭키 암호화 방식으로 통신한다.** 

</br>




# HTTPS
HTTP란 HyperText Transfer Protocol의 약자로써, 풀어서 설명하면 하이퍼텍스트(HyperText)를 전송(Transfer)하기 위해 사용되는 통신 규약(Protocol)이다. 즉, 인터넷에서 HTML과 같은 문서를 사용자 컴퓨터에 설치된 웹 브라우저가 웹 서버에 요청할 때의 규칙이라고 할 수 있다. **HTTPS는 HTTP에 보안 기능을 추가한 프로토콜이다. HTTPS는 크게 아래 2가지 역할을 한다.**
* **내가 사이트에 보내는 정보들을 제 3자가 못 보게한다.**
* **접속한 사이트가 믿을 만한 곳인지를 알려준다.**

![](https://velog.velcdn.com/images/strangehoon/post/59ff97ff-7a15-484b-ad56-ed0bcf6f6d4e/image.png)

## HTTPS 통신흐름
SSL(Secure Socket Layer)은 SSL 1.0부터 시작해서 SSL 2.0, SSL 3.0, TLS(TransportLayer Security Protocol) 1.0, TLS 1.3까지 버전이 올라가며 마지막으로 TLS로 명칭이 변경되었다. 버전마다 동작 방식이 약간 다른데 아래서는 TLS 1.3을 기반으로 설명한다. TLS은 전송 계층에서 보안을 제공하는 프로토콜로서 클라이언트와 서버가 통신 할 때 제3자가 메시지를 도청하거나 변조하지 못하도록한다. 
![](https://velog.velcdn.com/images/strangehoon/post/0bf2b8ad-85bf-464f-b63a-2c0c057303d5/image.png)

1. 인터넷 사이트(서버)는 공개키와 개인키를 만들고, 신뢰할 수 있는 인증 기관(CA)에 자신의 정보와 공개키를 관리해달라고 계약하고 (경우에 따라) 돈을 지불한다.

2. 이 때, 계약을 완료한 인증 기관은 기관만의 공개키와 개인키가 있다. 인증 기관은 사이트가 제출된 데이터를 검증하고, 인증 기관의 개인키로 사이트에서 제출한 정보를 암호화해서 인증서를 만든다.
3. 만든 인증서를 사이트에 발급해준다.
3. 인증 기관은 웹 브라우저에게 자신의 공개키를 제공한다.


________________________

아래는 만약 사용자가 서버의 공개키로 암호화된 HTTPS가 아닌 요청을 전송했을 경우 동작을 나타낸다. 
![](https://velog.velcdn.com/images/strangehoon/post/0acc9c7f-ee90-4968-b71b-9fed195a999c/image.png)
> 그림은 TLS 1.3 이전 버전을 나타냄

1. Client Hello : 클라이언트는 TLS 버전, 사이퍼슈트와 클라이언트 랜덤값(무작위 문자열), 임시 DH 매개변수를 서버에 전송한다. 

2. Server Hello : 서버는 클라이언트, 서버 모두에서 지원하는 가장 높은 TLS 버전과 사이퍼슈트 지원 여부를 결정한다. 또한 서버는 자신의 인증서와 함께 랜덤값과 DH 매개변수를 웹 브라우저(클라이언트)에게 보낸다. 여기서 인증서는 서버의 정보가 인증 기관의 개인키로 암호화되어있다.

3. 웹 브라우저는 미리 알고 있던 인증기관의 공개키로 인증서를 해독하여 검증한다. 그러면 서버의 정보와 서버의 공개키를 알 수 있게 된다. 이 부분은 보안상의 의미는 없다. 단지 해당 서버로부터 온 응답임을 확신할 수 있게 된다.

4.  클라이언트와 서버 각각 서로 교환한 DH 매개변수를 사용하여 대칭키를 생성한다. 
4-1. 비대칭 암호화에는 크게 RSA와 DH가 있다. 위 그림은 RSA를 나타낸다. DH에서는 그림과 달리 클라이언트, 서버 각각 대칭키를 생성한다. 

**TLS 1.3 이전 버전**

4. 대칭키를 생성한다. 

5. 클라이언트는 서버의 공개키로 대칭키를 암호화하여 다시 서버에 보낸다. 서버는 개인키로 암호문을 해독하여 대칭키를 얻게 된다.

______________________________________

6. Finished : 이후 사용자, 서버간 통신을 할 때 주고받는 메세지는 이 대칭키를 이용하여 암호화, 복호화를 진행한다.
![](https://velog.velcdn.com/images/strangehoon/post/a408b315-b3ae-4b77-8f93-82f1da12ab68/image.png)

 
</br>


# HTTPS의 장단점
* **장점** 
  * 사이트에 보내는 정보들을 제 3자가 못 보게하고 접속한 사이트가 믿을 만한 곳인지를 알려주기 때문에 보안에 좋다.
  * 대표적인 검색 포털 사이트인 네이버, 구글, 다음 모두에서 검색 엔진 최적화를 통해 https를 상위 노출하고 있다. 

* **단점**
  * HTTPS는 설치 및 인증서를 유지하는 데 추가 비용이 발생한다.
  * 암호화하는 과정이 웹 서버에 부하를 준다. 
  * HTTP에 비해 속도가 느리다. 
  * 인터넷의 연결이 끊긴 경우 재인증에 시간이 소요된다. 


> 💡 **보통 일부 개발/테스트 환경처럼 보안 상의 이슈가 작을때 HTTP를 사용하기도 하지만 개인정보를 다루는 일반적인 웹 사이트에서는 HTTPS를 사용하는것이 더 좋다.**

</br>

# 참고자료
[HTTPS가 뭐고 왜 쓰나요? (Feat. 대칭키 vs. 비대칭키)](https://www.youtube.com/watch?v=H6lpFRpyl14) </br>
[👶🏻 신입 개발자 전공 지식 & 기술 면접 백과사전 📖](https://gyoogle.dev/blog/computer-science/network/HTTP%20&%20HTTPS.html) </br>
[HTTPS란? (동작방식, 장단점)](https://rachel-kwak.github.io/2021/03/08/HTTPS.html)
